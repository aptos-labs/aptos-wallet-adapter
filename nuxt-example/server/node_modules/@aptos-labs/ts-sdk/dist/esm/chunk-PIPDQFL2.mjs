import{a as w,d as dn,e as An,g as $}from"./chunk-XRVZAEQO.mjs";import{r as un}from"./chunk-IMYNN4TW.mjs";import{a as sn}from"./chunk-W2C5KRUQ.mjs";import{b as cn}from"./chunk-GRRBXHVG.mjs";import{a as on}from"./chunk-KK5HUWF6.mjs";import{a as rn}from"./chunk-ONGH5DXZ.mjs";import{a as f}from"./chunk-YWSDONJJ.mjs";import{a as an}from"./chunk-T7X4GZDU.mjs";import{a as Y,c as nn,d as tn}from"./chunk-27ESCVVC.mjs";import{c as z,d as L,e as Z,f as F,g as j,h as J,i as Q}from"./chunk-44EHAKKW.mjs";import{a as X}from"./chunk-LS3IDL2N.mjs";import{b as D,c as en,d as M,e as R,f as T}from"./chunk-BQYKFATL.mjs";import{a as q,b as l,c as H,d as h,e as x,f as B}from"./chunk-BPHCRTHD.mjs";import{b as O,c as V}from"./chunk-QUJM5W4L.mjs";import{a as E,b as p}from"./chunk-2TRQERBL.mjs";import{a as G}from"./chunk-JNNFNYDO.mjs";import{a as v}from"./chunk-XW3BXTCZ.mjs";import{i as b,j as k}from"./chunk-HVIF6DW6.mjs";import{b as N,d as W}from"./chunk-7OUPEQRN.mjs";import{a as C}from"./chunk-YOZBVVKL.mjs";import{a as U}from"./chunk-BMPHQ3E7.mjs";import{g as S}from"./chunk-4RXKALLC.mjs";import{b as K,c as _}from"./chunk-RJ7F4JDV.mjs";import{j as y}from"./chunk-BHVSIRNF.mjs";import{b as u}from"./chunk-LQOSHBB7.mjs";import{b as P}from"./chunk-VHY6ZATX.mjs";import{sha3_256 as ln}from"@noble/hashes/sha3";async function Ln(n){if(un(n))return wn(n);let{moduleAddress:e,moduleName:t,functionName:i}=y(n.function),r=await yn({key:"entry-function",moduleAddress:e,moduleName:t,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:dn});return hn({...n,abi:r})}function hn(n){let e=n.abi,{moduleAddress:t,moduleName:i,functionName:r}=y(n.function),a=w(n.typeArguments);if(a.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${a.length}`);let o=n.functionArguments.map((s,d)=>$(n.function,e,s,d,a));if(o.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${i}::${r}', expected ${e.parameters.length} but got ${o.length}`);let c=F.build(`${t}::${i}`,r,a,o);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new Z(new J(s,new Q(c)))}return new L(c)}async function Zn(n){let{moduleAddress:e,moduleName:t,functionName:i}=y(n.function),r=await yn({key:"view-function",moduleAddress:e,moduleName:t,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:An});return Tn({abi:r,...n})}function Tn(n){let e=n.abi,{moduleAddress:t,moduleName:i,functionName:r}=y(n.function),a=w(n.typeArguments);if(a.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${a.length}`);let o=n?.functionArguments?.map((c,s)=>$(n.function,e,c,s,a))??[];if(o.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${i}::${r}', expected ${e.parameters.length} but got ${o.length}`);return F.build(`${t}::${i}`,r,a,o)}function wn(n){return new z(new j(P.fromHexInput(n.bytecode).toUint8Array(),w(n.typeArguments),n.functionArguments))}async function In(n){let{aptosConfig:e,sender:t,payload:i,options:r,feePayerAddress:a}=n,o=async()=>S[e.network]?{chainId:S[e.network]}:{chainId:(await on({aptosConfig:e})).chain_id},c=async()=>r?.gasUnitPrice?{gasEstimate:r.gasUnitPrice}:{gasEstimate:(await cn({aptosConfig:e})).gas_estimate},s=async()=>{let g=async()=>r?.accountSequenceNumber!==void 0?r.accountSequenceNumber:(await sn({aptosConfig:e,accountAddress:t})).sequence_number;if(a&&u.from(a).equals(u.ZERO))try{return await g()}catch{return 0}else return g()},[{chainId:d},{gasEstimate:m},I]=await Promise.all([o(),c(),s()]),{maxGasAmount:fn,gasUnitPrice:gn,expireTimestamp:pn}={maxGasAmount:r?.maxGasAmount?BigInt(r.maxGasAmount):BigInt(2e5),gasUnitPrice:r?.gasUnitPrice??BigInt(m),expireTimestamp:r?.expireTimestamp??BigInt(Math.floor(Date.now()/1e3)+20)};return new Y(u.from(t),BigInt(I),i,BigInt(fn),BigInt(gn),BigInt(pn),new X(d))}async function jn(n){let{aptosConfig:e,sender:t,payload:i,options:r,feePayerAddress:a}=n,o=await In({aptosConfig:e,sender:t,payload:i,options:r,feePayerAddress:a});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new rn(o,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new an(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Jn(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:i,feePayerPublicKey:r}=n,a=A(e);if(t.feePayerAddress){let c=new tn(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];t.secondarySignerAddresses&&(i?s=i.map(I=>A(I)):s=Array.from({length:t.secondarySignerAddresses.length},()=>A(void 0)));let d=A(r),m=new R(a,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:d});return new f(c.raw_txn,m).bcsToBytes()}if(t.secondarySignerAddresses){let c=new nn(t.rawTransaction,t.secondarySignerAddresses),s=[];i?s=i.map(m=>A(m)):s=Array.from({length:t.secondarySignerAddresses.length},()=>A(void 0));let d=new M(a,t.secondarySignerAddresses,s);return new f(c.raw_txn,d).bcsToBytes()}let o;if(a instanceof l)o=new D(a.public_key,a.signature);else if(a instanceof h||a instanceof x)o=new T(a);else if(a instanceof B)o=new T(a);else throw new Error("Invalid public key");return new f(t.rawTransaction,o).bcsToBytes()}function A(n){if(!n)return new B;let t=b.isInstance(n)||v.isInstance(n)||G.isInstance(n)?new E(n):n,i=new W(new Uint8Array(64));if(N.isInstance(t))return new l(t,i);if(E.isInstance(t))return b.isInstance(t.publicKey)?new h(t,new p(k.getSimulationSignature())):new h(t,new p(i));if(O.isInstance(t))return new x(t,new V({signatures:t.publicKeys.map(()=>new p(i)),bitmap:t.createBitmap({bits:Array(t.publicKeys.length).fill(0).map((r,a)=>a)})}));throw new Error("Unsupported PublicKey used for simulations")}function Pn(n){let{transaction:e,feePayerAuthenticator:t,additionalSignersAuthenticators:i}=n,r=U(q,n.senderAuthenticator),a;if(e.feePayerAddress){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");a=new R(r,e.secondarySignerAddresses??[],i??[],{address:e.feePayerAddress,authenticator:t})}else if(e.secondarySignerAddresses){if(!i)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");a=new M(r,e.secondarySignerAddresses,i)}else r instanceof l?a=new D(r.public_key,r.signature):r instanceof H?a=new en(r.public_key,r.signature):a=new T(r);return new f(e.rawTransaction,a).bcsToBytes()}function mn(n){let e=ln.create();for(let t of n)e.update(t);return e.digest()}var Sn=mn(["APTOS::Transaction"]);function Qn(n){let e=Pn(n);return new P(mn([Sn,new Uint8Array([0]),e])).toString()}async function yn({key:n,moduleAddress:e,moduleName:t,functionName:i,aptosConfig:r,abi:a,fetch:o}){return a!==void 0?a:C(async()=>o(e,t,i,r),`${n}-${r.network}-${e}-${t}-${i}`,1e3*60*5)()}export{Ln as a,hn as b,Zn as c,Tn as d,In as e,jn as f,Jn as g,A as h,Pn as i,mn as j,Qn as k};
//# sourceMappingURL=chunk-PIPDQFL2.mjs.map