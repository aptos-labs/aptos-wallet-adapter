"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[416],{20774:function(e,t,r){r.r(t),r.d(t,{AptosCircleBridge:function(){return f}});var s=r(79456),a=r(10475),n=r(80033),i=r(24111),c=r(26862),o=r(85570);let d=(0,r(22256).J)([["Mainnet",{depositForBurn:"0xa11ceb0b0700000a0701000802080e031614042a04052e30075e870108e5014000000001000201030004000001050701000100060b0001070304010801020805060108010309080900010002010205060c030e05050208000b010108020108020105010b0101090003060c0b01010900030108000004060c08000e0501030e66756e6769626c655f6173736574066f626a656374167072696d6172795f66756e6769626c655f73746f72650f746f6b656e5f6d657373656e6765720d46756e6769626c654173736574064f626a656374084d6574616461746111616464726573735f746f5f6f626a656374087769746864726177106465706f7369745f666f725f6275726e00000000000000000000000000000000000000000000000000000000000000019bce6734f7b63e835108e3bd8c36743d4709fe435f44791918801d0989640a9d0000010f0b0438000c060a000b060b0138010c050b000b050b020b0311020102",handleReceiveMessage:"0xa11ceb0b0700000a0601000402040403080c051416072a53087d40000001010002000000030203000101040304000103060c0a020a020003060c060a02060a020108000101136d6573736167655f7472616e736d69747465720f746f6b656e5f6d657373656e67657207526563656970740f726563656976655f6d6573736167651668616e646c655f726563656976655f6d657373616765177e17751820e4b4371873ca8c30279be63bdea63b88ed0f2239c2eea10f17729bce6734f7b63e835108e3bd8c36743d4709fe435f44791918801d0989640a9d000001070b000e010e02110011010102"}],["Testnet",{depositForBurn:"0xa11ceb0b0700000a0701000802080e031614042a04052e30075e870108e5014000000001000201030004000001050701000100060b0001070304010801020805060108010309080900010002010205060c030e05050208000b010108020108020105010b0101090003060c0b01010900030108000004060c08000e0501030e66756e6769626c655f6173736574066f626a656374167072696d6172795f66756e6769626c655f73746f72650f746f6b656e5f6d657373656e6765720d46756e6769626c654173736574064f626a656374084d6574616461746111616464726573735f746f5f6f626a656374087769746864726177106465706f7369745f666f725f6275726e00000000000000000000000000000000000000000000000000000000000000015f9b937419dda90aa06c1836b7847f65bbbe3f1217567758dc2488be31a477b90000010f0b0438000c060a000b060b0138010c050b000b050b020b0311020102",handleReceiveMessage:"0xa11ceb0b0700000a0601000402040403080c051416072a53087d40000001010002000000030203000101040304000103060c0a020a020003060c060a02060a020108000101136d6573736167655f7472616e736d69747465720f746f6b656e5f6d657373656e67657207526563656970740f726563656976655f6d6573736167651668616e646c655f726563656976655f6d657373616765081e86cebf457a0c6004f35bd648a2794698f52e0dde09a48619dcd3d4cc23d95f9b937419dda90aa06c1836b7847f65bbbe3f1217567758dc2488be31a477b9000001070b000e010e02110011010102"}]],[0,1]);class f{network;chain;provider;contracts;usdcId;tokenMessengerId;messageTransmitterId;moveScripts;constructor(e,t,r,s){if(this.network=e,this.chain=t,this.provider=r,this.contracts=s,"Devnet"===e)throw Error("CircleBridge not supported on Devnet");let a=c.UO.get(this.network,this.chain);if(!a)throw Error(`No USDC contract configured for network=${this.network} chain=${this.chain}`);if(!s.cctp?.tokenMessenger)throw Error(`Circle Token Messenger contract for domain ${t} not found`);if(!s.cctp?.messageTransmitter)throw Error(`Circle Message Transmitter contract for domain ${t} not found`);if(!d.has(e))throw Error("No Aptos CCTP move scripts found");this.usdcId=a,this.tokenMessengerId=s.cctp?.tokenMessenger,this.messageTransmitterId=s.cctp.messageTransmitter,this.moveScripts=d.get(e)}async *transfer(e,t,r){let s=new a.PMf(c.vw.get(this.network,t.chain)),n=a.kxK.from(this.usdcId),i=a.kxK.from(t.address.toUniversalAddress().toUint8Array()),o=[new a.G90(r),s,i,n],d={bytecode:this.moveScripts.depositForBurn,functionArguments:o};yield this.createUnsignedTx(d,"Aptos.CircleBridge.Transfer")}async isTransferCompleted(e){let t=new a.PMf(e.sourceDomain).bcsToBytes(),r=new a.G90(e.nonce).bcsToBytes(),n=(0,s.Ev)(new Uint8Array([...t,45,...r])),i=o.$v.encode(n);return(await this.provider.view({payload:{function:`${this.messageTransmitterId}::message_transmitter::is_nonce_used`,functionArguments:[i]}}))[0]}async *redeem(e,t,r){let n=[a.sFe.U8(s.iC.serialize(t)),a.sFe.U8(o.$v.decode(r))],i={bytecode:this.moveScripts.handleReceiveMessage,functionArguments:n};yield this.createUnsignedTx(i,"Aptos.CircleBridge.Redeem")}async parseTransactionDetails(e){let t,r;for(let s=0;s<5;s++)try{let a=await this.provider.getTransactionByHash({transactionHash:e}),n=this.messageTransmitterId.replace(/^0x0+/,"0x");if(r=a.events?.find(e=>e.type===`${n}::message_transmitter::MessageSent`))break;t=Error(`MessageSent event not found in transaction ${e}`),s<4&&await new Promise(e=>setTimeout(e,1e3))}catch(e){t=e,s<4&&await new Promise(e=>setTimeout(e,1e3))}if(!r)throw t||Error("No MessageSent event found after 5 attempts");let a=o.$v.decode(r.data.message),[n,i]=s.iC.deserialize(a),{payload:d}=n,f=d.messageSender,b=d.mintRecipient,h=c.yN(this.network,n.sourceDomain),m=c.yN(this.network,n.destinationDomain),l={chain:h,address:d.burnToken};return{from:{chain:h,address:f},to:{chain:m,address:b},token:l,amount:d.amount,message:n,id:{hash:i}}}static async fromRpc(e,t){let[r,s]=await n.O.chainFromRpc(e),a=t[s];if(a.network!==r)throw Error(`Network mismatch: ${a.network} != ${r}`);return new f(r,s,e,a.contracts)}createUnsignedTx(e,t,r=!1){return new i.N(e,this.network,this.chain,t,r)}}(0,s.sW)("Aptos","CircleBridge",f)},24111:function(e,t,r){r.d(t,{N:function(){return s}});class s{transaction;network;chain;description;parallelizable;constructor(e,t,r,s,a=!1){this.transaction=e,this.network=t,this.chain=r,this.description=s,this.parallelizable=a}}}}]);