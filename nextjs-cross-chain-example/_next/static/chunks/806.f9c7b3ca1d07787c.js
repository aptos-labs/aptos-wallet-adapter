"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{95806:function(t,e,n){n.r(e),n.d(e,{EvmTBTCBridge:function(){return T}});var a=n(79456),r=n(97957),i=n(64303),s=n(16084),o=n(156),c=n(63044),d=n(17255),h=n(29347),w=n(66085);class T{network;chain;provider;contracts;chainId;core;gatewayAddress;gateway;tbtcTokenAddr;constructor(t,e,n,r){if(this.network=t,this.chain=e,this.provider=n,this.contracts=r,"Mainnet"!==this.network)throw Error("TBTC is only supported on Mainnet");if(!this.contracts.tbtc)throw Error("TBTC contract address is required");let s=a.k4.getNativeTbtcToken(this.chain);if(!s)throw Error("Native tbtc token not found");this.chainId=i.X.get(t,e),this.core=new w.EvmWormholeCore(t,e,n,r),this.gatewayAddress=this.contracts.tbtc,this.gateway=new h.CH(this.gatewayAddress,["function sendTbtc(uint256 amount, uint16 recipientChain, bytes32 recipient, uint256 arbiterFee, uint32 nonce) payable returns (uint64)","function receiveTbtc(bytes calldata encodedVm)"],n),this.tbtcTokenAddr=(0,a.QC)(s)}static async fromRpc(t,e){let[n,a]=await s.W.chainFromRpc(t),r=e[a];if(r.network!==n)throw Error(`Network mismatch: ${r.network} != ${n}`);return new T(n,a,t,r.contracts)}async *transfer(t,e,n){let a=new o.V(t).toString(),i=await this.gateway.sendTbtc.populateTransaction(n,(0,d.Vn)(e.chain),e.address.toUniversalAddress().toUint8Array(),0n,0n);i.value=await this.core.getMessageFee(),yield*this.approve(a,n,this.gatewayAddress),yield this.createUnsignedTransaction((0,r.Dt)(i,a),"TBTCBridge.Send")}async *redeem(t,e){if("GatewayTransfer"!==e.payloadName)throw Error("Invalid VAA payload");let n=new o.V(t).toString(),i=await this.gateway.receiveTbtc.populateTransaction((0,a.qC)(e));yield this.createUnsignedTransaction((0,r.Dt)(i,n),"TBTCBridge.Redeem")}async *approve(t,e,n){let a=s.W.getTokenImplementation(this.provider,this.tbtcTokenAddr);if(await a.allowance(t,n)<e){let i=await a.approve.populateTransaction(n,e);yield this.createUnsignedTransaction((0,r.Dt)(i,t),"TBTC.Approve")}}createUnsignedTransaction(t,e){return new c.z((0,r.rQ)(t,this.chainId),this.network,this.chain,e,!1)}}(0,a.sW)(r.c0,"TBTCBridge",T)}}]);