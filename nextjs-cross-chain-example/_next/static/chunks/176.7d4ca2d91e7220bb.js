"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{81176:function(e,t,n){n.r(t),n.d(t,{IDL:function(){return U},SolanaWormholeCore:function(){return eh},deserializePostMessage:function(){return y},postMessageLayout:function(){return f},utils:function(){return a}});var r,i,a={};n.r(a),n.d(a,{BridgeConfig:function(){return D},BridgeData:function(){return G},GuardianSetData:function(){return Y},SequenceTracker:function(){return X},SignatureSetData:function(){return eb},coder:function(){return k},createBridgeFeeTransferInstruction:function(){return ea},createInitializeInstruction:function(){return eF},createPostMessageInstruction:function(){return er},createPostVaaInstruction:function(){return el},createReadOnlyWormholeProgramInterface:function(){return L},createSetFeesInstruction:function(){return eB},createTransferFeesInstruction:function(){return eC},createUpgradeContractInstruction:function(){return e_},createUpgradeGuardianSetInstruction:function(){return ek},createVerifySignaturesInstructions:function(){return ec},createWormholeProgramInterface:function(){return C},deriveClaimKey:function(){return ew},deriveEmitterSequenceKey:function(){return O},deriveFeeCollectorKey:function(){return et},deriveGuardianSetKey:function(){return z},derivePostedVaaKey:function(){return eo},deriveUpgradeAuthorityKey:function(){return eP},deriveWormholeBridgeDataKey:function(){return R},deriveWormholeEmitterKey:function(){return Z},getClaim:function(){return eI},getEmitterKeys:function(){return H},getGuardianSet:function(){return q},getInitializeAccounts:function(){return ez},getPostMessageAccounts:function(){return ei},getPostMessageCpiAccounts:function(){return ex},getPostVaaAccounts:function(){return ef},getProgramSequenceTracker:function(){return Q},getSequenceTracker:function(){return J},getSetFeesAccounts:function(){return eU},getSignatureSetData:function(){return ev},getTransferFeesAccounts:function(){return eL},getUpgradeContractAccounts:function(){return eV},getUpgradeGuardianSetAccounts:function(){return eT},getVerifySignatureAccounts:function(){return eg},getWormholeBridgeData:function(){return N},getWormholeDerivedAccounts:function(){return eA}});var s=n(47041),o=n(18447),u=n(2718),c=n(5729),g=n(31424),m=n(99389),d=n(23791),l=n(53374);let f=[{name:"discriminator",binary:"bytes",size:4},{name:"consistencyLevel",binary:"uint",size:1,endianness:"little"},{name:"emitterAuthority",...o.N3.universalAddressItem},{name:"messageStatus",binary:"uint",size:1,endianness:"little"},{name:"gap",binary:"uint",size:3},{name:"timestamp",binary:"uint",size:4,endianness:"little"},{name:"nonce",binary:"uint",size:4,endianness:"little"},{name:"sequence",binary:"uint",size:8,endianness:"little"},{name:"emitterChain",binary:"uint",size:2,endianness:"little"},{name:"emitterAddress",...o.N3.universalAddressItem},{name:"payloadLength",binary:"uint",size:4,endianness:"little"},{name:"payload",binary:"bytes"}];function y(e){return(0,l.vB)(f,e)}var p=n(70774),h=n(53477),S=n(67806);n(80487).Buffer;class w{idl;constructor(e){this.idl=e}async encode(e,t){throw Error(`Invalid account name: ${e}`)}decode(e,t){return this.decodeUnchecked(e,t)}decodeUnchecked(e,t){throw Error(`Invalid account name: ${e}`)}memcmp(e,t){if("postVaa"===e)return{dataSize:56};throw Error(`Invalid account name: ${e}`)}size(e){return S.X(this.idl,e)??0}}class I{constructor(e){}decode(e){throw Error("Wormhole program does not have events")}}var v=n(15383);function b(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/[\s\-_]+/g,"")}var M=n(76198);class P{static fieldLayout(e,t){let n=void 0!==e.name?b(e.name):void 0;switch(e.type){case"bool":return M.bool(n);case"u8":return M.u8(n);case"i8":return M.i8(n);case"u16":return M.u16(n);case"i16":return M.i16(n);case"u32":return M.u32(n);case"i32":return M.i32(n);case"f32":return M.f32(n);case"u64":return M.u64(n);case"i64":return M.i64(n);case"f64":return M.f64(n);case"u128":return M.u128(n);case"i128":return M.i128(n);case"u256":return M.u256(n);case"i256":return M.i256(n);case"bytes":return M.vecU8(n);case"string":return M.str(n);case"publicKey":return M.publicKey(n);default:if("vec"in e.type)return M.vec(P.fieldLayout({name:void 0,type:e.type.vec},t),n);if("option"in e.type)return M.option(P.fieldLayout({name:void 0,type:e.type.option},t),n);if("array"in e.type){let r=e.type.array[0],i=e.type.array[1],a=P.fieldLayout({name:void 0,type:r},t);return M.array(a,i,n)}throw Error(`Not yet implemented: ${e}`)}}}var A=n(80487).Buffer;class x{ixLayout;constructor(e){this.ixLayout=x.parseIxLayout(e)}static parseIxLayout(e){return new Map((e.instructions?e.instructions:[]).map(t=>{let n=t.args.map(t=>P.fieldLayout(t,Array.from([...e.accounts??[],...e.types??[]]))),r=b(t.name);return[r,M.struct(n,r)]}).concat(e.instructions.map(t=>{let n=t.args.map(t=>P.fieldLayout(t,Array.from([...e.accounts??[],...e.types??[]]))),r=b(t.name);return[r,M.struct(n,r)]})))}encode(e,t){let n=A.alloc(1e3),r=b(e),a=this.ixLayout.get(r);if(!a)throw Error(`Unknown method: ${r}`);let s=a.encode(t,n),o=n.slice(0,s);return function(e,t){let n=A.alloc(1+(void 0===t?0:t.length));return n.writeUInt8(e,0),void 0!==t&&n.write(t.toString("hex"),1,"hex"),n}(i[r.charAt(0).toUpperCase()+r.slice(1)],o)}encodeState(e,t){throw Error("Wormhole program does not have state")}decode(e,t="hex"){"string"==typeof e&&(e="hex"===t?A.from(e,"hex"):v.O.decode(e));let n=A.from(e.slice(0,1)).readInt8(),r=A.from(e.slice(1)),a=b(i[n]??"");return this.ixLayout.get(a)?{data:this.ixLayout.get(a)?.decode(r),name:a}:null}}(r=i||(i={}))[r.Initialize=0]="Initialize",r[r.PostMessage=1]="PostMessage",r[r.PostVaa=2]="PostVaa",r[r.SetFees=3]="SetFees",r[r.TransferFees=4]="TransferFees",r[r.UpgradeContract=5]="UpgradeContract",r[r.UpgradeGuardianSet=6]="UpgradeGuardianSet",r[r.VerifySignatures=7]="VerifySignatures",r[r.PostMessageUnreliable=8]="PostMessageUnreliable";class E{constructor(e){}encode(e,t){throw Error("Wormhole program does not have state")}decode(e){throw Error("Wormhole program does not have state")}}class K{constructor(e){}encode(e,t){throw Error("Wormhole program does not have user-defined types")}decode(e,t){throw Error("Wormhole program does not have user-defined types")}}class B{instruction;accounts;state;events;types;constructor(e){this.instruction=new x(e),this.accounts=new w(e),this.state=new E(e),this.events=new I(e),this.types=new K(e)}}let U={version:"0.1.0",name:"wormhole",instructions:[{name:"initialize",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"guardianSet",isMut:!0,isSigner:!1},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"guardianSetExpirationTime",type:"u32"},{name:"fee",type:"u64"},{name:"initialGuardians",type:{vec:{array:["u8",20]}}}]},{name:"postMessage",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"message",isMut:!0,isSigner:!0},{name:"emitter",isMut:!1,isSigner:!0},{name:"sequence",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"nonce",type:"u32"},{name:"payload",type:"bytes"},{name:"consistencyLevel",type:"u8"}]},{name:"postVaa",accounts:[{name:"guardianSet",isMut:!1,isSigner:!1},{name:"bridge",isMut:!1,isSigner:!1},{name:"signatureSet",isMut:!1,isSigner:!1},{name:"vaa",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"version",type:"u8"},{name:"guardianSetIndex",type:"u32"},{name:"timestamp",type:"u32"},{name:"nonce",type:"u32"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"sequence",type:"u64"},{name:"consistencyLevel",type:"u8"},{name:"payload",type:"bytes"}]},{name:"setFees",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"transferFees",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"recipient",isMut:!0,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"upgradeContract",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"upgradeAuthority",isMut:!1,isSigner:!1},{name:"spill",isMut:!0,isSigner:!1},{name:"implementation",isMut:!0,isSigner:!1},{name:"programData",isMut:!0,isSigner:!1},{name:"wormholeProgram",isMut:!0,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"bpfLoaderUpgradeable",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"upgradeGuardianSet",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"guardianSetOld",isMut:!0,isSigner:!1},{name:"guardianSetNew",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"verifySignatures",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"guardianSet",isMut:!1,isSigner:!1},{name:"signatureSet",isMut:!0,isSigner:!0},{name:"instructions",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"signatureStatus",type:{array:["i8",19]}}]},{name:"postMessageUnreliable",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"message",isMut:!0,isSigner:!0},{name:"emitter",isMut:!1,isSigner:!0},{name:"sequence",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"nonce",type:"u32"},{name:"payload",type:"bytes"},{name:"consistencyLevel",type:"u8"}]}],accounts:[{name:"PostedMessage",type:{kind:"struct",fields:[{name:"vaaVersion",type:"u8"},{name:"consistencyLevel",type:"u8"},{name:"vaaTime",type:"u32"},{name:"vaaSignatureAccount",type:"publicKey"},{name:"submissionTime",type:"u32"},{name:"nonce",type:"u32"},{name:"sequence",type:"u64"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"payload",type:"bytes"}]}},{name:"PostedVAA",type:{kind:"struct",fields:[{name:"vaaVersion",type:"u8"},{name:"consistencyLevel",type:"u8"},{name:"vaaTime",type:"u32"},{name:"vaaSignatureAccount",type:"publicKey"},{name:"submissionTime",type:"u32"},{name:"nonce",type:"u32"},{name:"sequence",type:"u64"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"payload",type:"bytes"}]}}]};function C(e,t){return new p.$r(U,new u.PublicKey(e),void 0===t?{connection:null}:t,k())}function L(e,t){return C(e,h.Km(t))}function k(){return new B(U)}var T=n(80487).Buffer;class _{static serialize(e,t,n){if(0==e.length)throw Error("signatures.length == 0");if(e.length!=t.length)throw Error("signatures.length != keys.length");if(32!=n.length)throw Error("message.length != 32");let r=e.length,i=1+11*r,a=i+85*r,s=T.alloc(a+32);s.writeUInt8(r,0),s.write(n.toString("hex"),a,"hex");for(let n=0;n<r;++n){let r=e.at(n);if(r?.length!=65)throw Error(`signatures[${n}].length != 65`);let o=t.at(n);if(o?.length!=20)throw Error(`keys[${n}].length != 20`);let u=i+85*n,c=u+65;s.writeUInt16LE(u,1+11*n),s.writeUInt8(0,3+11*n),s.writeUInt16LE(c,4+11*n),s.writeUInt8(0,6+11*n),s.writeUInt16LE(a,7+11*n),s.writeUInt16LE(32,9+11*n),s.writeUInt8(0,10+11*n),s.write(r.toString("hex"),u,"hex"),s.write(o.toString("hex"),c,"hex")}return s}}var V=n(40845),F=n(80487).Buffer;function z(e,t){return V.xc([F.from("GuardianSet"),(()=>{let e=F.alloc(4);return e.writeUInt32BE(t),e})()],e)}async function q(e,t,n,r){return e.getAccountInfo(z(t,n),r).then(e=>Y.deserialize(V.ae(e)))}class Y{index;keys;creationTime;expirationTime;constructor(e,t,n,r){this.index=e,this.keys=t,this.creationTime=n,this.expirationTime=r}static deserialize(e){let t=e.readUInt32LE(0),n=e.readUInt32LE(4),r=8+20*n,i=e.readUInt32LE(r),a=e.readUInt32LE(4+r),s=[];for(let t=0;t<n;++t){let n=8+20*t;s.push(e.subarray(n,n+20))}return new Y(t,s,i,a)}}var W=n(80487).Buffer;function R(e){return V.xc([W.from("Bridge")],e)}async function N(e,t,n){return e.getAccountInfo(R(t),n).then(e=>G.deserialize(V.ae(e)))}class D{guardianSetExpirationTime;fee;constructor(e,t){this.guardianSetExpirationTime=e,this.fee=t}static deserialize(e){if(12!=e.length)throw Error("data.length != 12");return new D(e.readUInt32LE(0),e.readBigUInt64LE(4))}}class G{guardianSetIndex;lastLamports;config;constructor(e,t,n){this.guardianSetIndex=e,this.lastLamports=t,this.config=n}static deserialize(e){if(24!=e.length)throw Error("data.length != 24");return new G(e.readUInt32LE(0),e.readBigUInt64LE(4),D.deserialize(e.subarray(12)))}}var $=n(80487).Buffer;function O(e,t){return V.xc([$.from("Sequence"),new u.PublicKey(e).toBytes()],t)}async function J(e,t,n,r){return e.getAccountInfo(O(t,n),r).then(e=>X.deserialize(V.ae(e)))}class X{sequence;bump;emitterType;constructor(e,t,n){this.sequence=e,this.bump=t,this.emitterType=n}static deserialize(e){let t,n;if(8!==e.length&&10!==e.length)throw Error("data.length != 8 or data.length != 10");let r=e.readBigUInt64LE(0);return 10===e.length&&(t=e[8],n=e[9]),new X(r,t,n)}value(){return this.sequence}}var j=n(80487).Buffer;function Z(e){return V.xc([j.from("emitter")],e)}function H(e,t){let n=Z(e);return{emitter:n,sequence:O(n,t)}}async function Q(e,t,n,r){return J(e,Z(t),n,r)}var ee=n(80487).Buffer;function et(e){return V.xc([ee.from("fee_collector")],e)}var en=n(80487).Buffer;function er(e,t,n,r,i,a,s){let o=L(t,e).methods.postMessage(a,en.from(i),s);return o._ixFn(...o._args,{accounts:ei(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function ei(e,t,n,r){let i;return r?{emitter:r,sequence:i}=H(r,e):i=O(r=t,e),{bridge:R(e),message:new u.PublicKey(n),emitter:new u.PublicKey(r),sequence:i,payer:new u.PublicKey(t),feeCollector:et(e),clock:u.SYSVAR_CLOCK_PUBKEY,rent:u.SYSVAR_RENT_PUBKEY,systemProgram:u.SystemProgram.programId}}function ea(e,t,n){return u.SystemProgram.transfer({fromPubkey:new u.PublicKey(t),toPubkey:et(e),lamports:n})}var es=n(80487).Buffer;function eo(e,t){return V.xc([es.from("PostedVAA"),t],e)}var eu=n(80487).Buffer;async function ec(e,t,n,r,i,a){let s=r.guardianSet,o=await q(e,t,s,a),c=r.signatures,g=o.keys,m=[];for(let a=0;a<Math.ceil(c.length/7);++a){var d;let s=7*a,o=Math.min(c.length,(a+1)*7),l=Array(19).fill(-1),f=[],y=[];for(let e=0;e<o-s;++e){let t=c.at(e+s);f.push(eu.from(t.signature.encode())),y.push(g.at(t.guardianIndex)),l[t.guardianIndex]=e}m.push((d=eu.from(r.hash),new u.TransactionInstruction({keys:[],programId:u.Secp256k1Program.programId,data:_.serialize(f,y,d)}))),m.push(function(e,t,n,r,i,a){let s=L(t,e).methods.verifySignatures(a);return s._ixFn(...s._args,{accounts:eg(t,n,i,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}(e,t,n,r,i,l))}return m}function eg(e,t,n,r){return{payer:new u.PublicKey(t),guardianSet:z(e,r.guardianSet),signatureSet:new u.PublicKey(n),instructions:u.SYSVAR_INSTRUCTIONS_PUBKEY,rent:u.SYSVAR_RENT_PUBKEY,systemProgram:u.SystemProgram.programId}}var em=n(4539),ed=n(80487).Buffer;function el(e,t,n,r,i){let a=L(t,e).methods.postVaa(1,r.guardianSet,r.timestamp,r.nonce,(0,c.Vn)(r.emitterChain),[...r.emitterAddress.toUint8Array()],new em(r.sequence.toString()),r.consistencyLevel,ed.from((0,o.al)(r.payloadLiteral,r.payload)));return a._ixFn(...a._args,{accounts:ef(t,n,i,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function ef(e,t,n,r){return{guardianSet:z(e,r.guardianSet),bridge:R(e),signatureSet:new u.PublicKey(n),vaa:eo(e,ed.from(r.hash)),payer:new u.PublicKey(t),clock:u.SYSVAR_CLOCK_PUBKEY,rent:u.SYSVAR_RENT_PUBKEY,systemProgram:u.SystemProgram.programId}}var ey=n(80487).Buffer;let ep="Program log: Sequence: ";class eh{network;chain;connection;contracts;chainId;coreBridge;address;bridgeData;constructor(e,t,n,r){this.network=e,this.chain=t,this.connection=n,this.contracts=r,this.chainId=(0,c.Vn)(t);let i=r.coreBridge;if(!i)throw Error(`CoreBridge contract Address for chain ${t} not found`);this.address=i,this.coreBridge=L(i,n)}async getGuardianSet(e){let t=await q(this.connection,this.coreBridge.programId,e);return{index:t.index,keys:t.keys.map(e=>e.toString("hex")),expiry:BigInt(t.expirationTime)}}static async fromRpc(e,t){let[n,r]=await g.d.chainFromRpc(e),i=t[r];if(i.network!==n)throw Error(`Network mismatch for chain ${r}: ${i.network} != ${n}`);return new eh(n,r,e,t[r].contracts)}async ensureBridgeConfig(){this.bridgeData||(this.bridgeData=await N(this.connection,this.coreBridge.programId))}async getMessageFee(){return await this.ensureBridgeConfig(),this.bridgeData.config.fee}async getGuardianSetIndex(){return await this.ensureBridgeConfig(),this.bridgeData.guardianSetIndex}async *publishMessage(e,t,n,r){let i=u.Keypair.generate(),a=new m.W(e).unwrap(),s=er(this.connection,this.coreBridge.programId,a,i.publicKey,t,n,r),o=await this.getMessageFee(),c=ea(this.coreBridge.programId,a,o),g=new u.Transaction;g.feePayer=a,g.add(c,s),yield this.createUnsignedTx({transaction:g,signers:[i]},"Core.PublishMessage")}async *verifyMessage(e,t){yield*this.postVaa(e,t)}async *postVaa(e,t){let n=eo(this.coreBridge.programId,ey.from(t.hash));if(await this.connection.getAccountInfo(n))return;let r=new m.W(e).unwrap(),i=u.Keypair.generate(),a=await ec(this.connection,this.coreBridge.programId,r,t,i.publicKey);for(let e=0;e<a.length;e+=2){let t=new u.Transaction().add(...a.slice(e,e+2));t.feePayer=r,yield this.createUnsignedTx({transaction:t,signers:[i]},"Core.VerifySignature",!0)}let s=new u.Transaction().add(el(this.connection,this.coreBridge.programId,r,t,i.publicKey));s.feePayer=r,yield this.createUnsignedTx({transaction:s},"Core.PostVAA")}static parseSequenceFromLog(e,t){let{meta:n,transaction:{message:r}}=t;if(!n?.innerInstructions?.length)return[];let i=r.staticAccountKeys;if(0===i.filter(t=>t.toString()===e).length)return[];let a=n?.logMessages?.filter(e=>e.startsWith(ep))?.[0]?.replace(ep,"");if(!a)return[];let s=[];for(let t of n?.innerInstructions){let n=t.instructions;s.push(...n.filter(t=>t.programIdIndex in i&&i[t.programIdIndex].toString()===e))}return s.length<1||i.length<3?[]:s.map(e=>[new m.W(i[e.accounts[2]]).toUniversalAddress(),BigInt(a)]).filter(e=>null!==e)}async getMessageAccountKeys(e){let t;if("string"!=typeof e.transaction.message.version){if(e.meta.loadedAddresses)t=e.transaction.message.getAccountKeys({accountKeysFromLookups:e.meta.loadedAddresses});else{let n=await Promise.all(e.transaction.message.addressTableLookups.map(async e=>{let t=await this.connection.getAddressLookupTable(e.accountKey);if(!t||!t.value)throw Error("Could not resolve lookup table: "+e.accountKey.toBase58());return t.value}));t=e.transaction.message.getAccountKeys({addressLookupTableAccounts:n})}}else t=e.transaction.message.getAccountKeys();return t}async findInstructions(e,t){let{meta:n,transaction:{message:r}}=t,i=this.coreBridge.programId;return[...n.innerInstructions?.flatMap(t=>t.instructions.filter(t=>i.toString()===e.get(t.programIdIndex).toString())).map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts})),...r.compiledInstructions.filter(t=>i.toString()===e.get(t.programIdIndex).toString())]}async parsePostMessageAccount(e){let t=await this.connection.getAccountInfo(e);if(!t?.data)throw Error("No data found in message account");let{timestamp:n,emitterAddress:r,emitterChain:i,consistencyLevel:a,sequence:s,nonce:u,payload:g}=y(new Uint8Array(t?.data));return(0,o.oN)("Uint8Array",{guardianSet:await this.getGuardianSetIndex(),emitterChain:(0,c.k5)(i),timestamp:n,emitterAddress:r,consistencyLevel:a,sequence:s,nonce:u,payload:g,signatures:[]})}async parseTransaction(e){let t=await this.connection.getTransaction(e,{maxSupportedTransactionVersion:0});if(!t||!t.meta||!t.meta.innerInstructions)throw Error("transaction not found");try{let e=eh.parseSequenceFromLog(this.coreBridge.programId.toBase58(),t);if(e.length>0){let[t,n]=e[0];return[{chain:this.chain,emitter:t,sequence:n}]}}catch{}let n=await this.getMessageAccountKeys(t),r=await this.findInstructions(n,t);if(!r||0===r.length)throw Error("no bridge messages found");let i=r.map(async e=>{let t=n.get(e.accountKeyIndexes[1]),r=await this.parsePostMessageAccount(t);return{chain:r.emitterChain,emitter:r.emitterAddress,sequence:r.sequence}});return await Promise.all(i)}async parseMessages(e){let t=await this.connection.getTransaction(e,{maxSupportedTransactionVersion:0});if(!t||!t.meta||!t.meta.innerInstructions)throw Error("transaction not found");let n=await this.getMessageAccountKeys(t),r=await this.findInstructions(n,t);if(!r||0===r.length)throw Error("no bridge messages found");let i=r.map(async e=>{let t=n.get(e.accountKeyIndexes[1]);return await this.parsePostMessageAccount(t)});return await Promise.all(i)}createUnsignedTx(e,t,n=!1){return new d.D(e,this.network,this.chain,t,n)}}var eS=n(80487).Buffer;function ew(e,t,n,r){let i="string"==typeof t?eS.from(t,"hex"):eS.from(t);if(32!=i.length)throw Error("address.length != 32");let a=eS.alloc(8);return a.writeBigUInt64BE("number"==typeof r?BigInt(r):r),V.xc([i,(()=>{let e=eS.alloc(2);return e.writeUInt16BE(n),e})(),a],e)}async function eI(e,t,n,r,i,a){return e.getAccountInfo(ew(t,n,r,i),a).then(e=>!!V.ae(e)[0])}async function ev(e,t,n){return e.getAccountInfo(new u.PublicKey(t),n).then(e=>eb.deserialize(V.ae(e)))}class eb{signatures;hash;guardianSetIndex;constructor(e,t,n){this.signatures=e,this.hash=t,this.guardianSetIndex=n}static deserialize(e){let t=e.readUInt32LE(0),n=[...e.subarray(4,4+t)].map(e=>0!=e),r=4+t;return new eb(n,e.subarray(r,r+32),e.readUInt32LE(r+32))}}var eM=n(80487).Buffer;function eP(e){return V.xc([eM.from("upgrade")],e)}function eA(e,t){let{emitter:n,sequence:r}=H(e,t);return{wormholeBridge:R(t),wormholeEmitter:n,wormholeSequence:r,wormholeFeeCollector:et(t)}}function ex(e,t,n,r){let i=ei(t,n,r,e);return{payer:i.payer,wormholeBridge:i.bridge,wormholeMessage:i.message,wormholeEmitter:i.emitter,wormholeSequence:i.sequence,wormholeFeeCollector:i.feeCollector,clock:i.clock,rent:i.rent,systemProgram:i.systemProgram}}var eE=n(99534),eK=n(80487).Buffer;function eB(e,t,n,r){let i=L(t,e).methods.setFees();return i._ixFn(...i._args,{accounts:eU(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function eU(e,t,n){return{payer:new u.PublicKey(t),bridge:R(e),vaa:eo(e,eK.from(n.hash)),claim:ew(e,n.emitterAddress.toString(),(0,c.Vn)(n.emitterChain),n.sequence),systemProgram:u.SystemProgram.programId}}function eC(e,t,n,r,i){let a=L(t,e).methods.transferFees();return a._ixFn(...a._args,{accounts:eL(t,n,r,i),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function eL(e,t,n,r){return{payer:new u.PublicKey(t),bridge:R(e),vaa:eo(e,eK.from(r.hash)),claim:ew(e,r.emitterAddress.toString(),(0,c.Vn)(r.emitterChain),r.sequence),feeCollector:et(e),recipient:new u.PublicKey(n),rent:u.SYSVAR_RENT_PUBKEY,systemProgram:u.SystemProgram.programId}}function ek(e,t,n,r){let i=L(t,e).methods.upgradeGuardianSet();return i._ixFn(...i._args,{accounts:eT(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function eT(e,t,n){return{payer:new u.PublicKey(t),bridge:R(e),vaa:eo(e,eK.from(n.hash)),claim:ew(e,n.emitterAddress.toString(),(0,c.Vn)(n.emitterChain),n.sequence),guardianSetOld:z(e,n.guardianSet),guardianSetNew:z(e,n.guardianSet+1),systemProgram:u.SystemProgram.programId}}function e_(e,t,n,r){let i=L(t,e).methods.upgradeContract();return i._ixFn(...i._args,{accounts:eV(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function eV(e,t,n,r){let{newContract:i}=n.payload.actionArgs;return{payer:new u.PublicKey(t),bridge:R(e),vaa:eo(e,eK.from(n.hash)),claim:ew(e,n.emitterAddress.toString(),(0,c.Vn)(n.emitterChain),n.sequence),upgradeAuthority:eP(e),spill:new u.PublicKey(void 0===r?t:r),implementation:new m.W(i).unwrap(),programData:eE.Gh(e),wormholeProgram:new u.PublicKey(e),rent:u.SYSVAR_RENT_PUBKEY,clock:u.SYSVAR_CLOCK_PUBKEY,bpfLoaderUpgradeable:eE.hI,systemProgram:u.SystemProgram.programId}}function eF(e,t,n,r,i,a){let s=L(t,e).methods.initialize(r,new em(i.toString()),[...a.map(e=>[...new Uint8Array(e)])]);return s._ixFn(...s._args,{accounts:ez(t,n),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function ez(e,t){return{bridge:R(e),guardianSet:z(e,0),feeCollector:et(e),payer:new u.PublicKey(t),clock:u.SYSVAR_CLOCK_PUBKEY,rent:u.SYSVAR_RENT_PUBKEY,systemProgram:u.SystemProgram.programId}}(0,o.sW)(s.c0,"WormholeCore",eh)},67806:function(e,t,n){n.d(t,{X:function(){return i}});class r extends Error{constructor(e){super(e),this.name="IdlError"}}function i(e,t){switch(t.type.kind){case"struct":return t.type.fields.map(t=>a(e,t.type)).reduce((e,t)=>e+t,0);case"enum":return Math.max(...t.type.variants.map(t=>t.fields?t.fields.map(t=>"object"==typeof t&&"name"in t?a(e,t.type):a(e,t)).reduce((e,t)=>e+t,0):0))+1;case"alias":return a(e,t.type.value)}}function a(e,t){switch(t){case"bool":case"u8":case"i8":case"bytes":case"string":return 1;case"i16":case"u16":return 2;case"u32":case"i32":case"f32":return 4;case"u64":case"i64":case"f64":return 8;case"u128":case"i128":return 16;case"u256":case"i256":case"publicKey":return 32;default:if("vec"in t)return 1;if("option"in t)return 1+a(e,t.option);if("coption"in t)return 4+a(e,t.coption);if("defined"in t){let n=e.types?.filter(e=>e.name===t.defined)??[];if(1!==n.length)throw new r(`Type not found: ${JSON.stringify(t)}`);return i(e,n[0])}if("array"in t){let n=t.array[0],r=t.array[1];return a(e,n)*r}throw Error(`Invalid type ${JSON.stringify(t)}`)}}},40845:function(e,t,n){n.d(t,{Yt:function(){return o},ae:function(){return c},og:function(){return u},xc:function(){return s}});var r=n(2718),i=n(80487).Buffer;let a=e=>"string"==typeof e?i.from(e):e;function s(e,t){return r.PublicKey.findProgramAddressSync(Array.isArray(e)?e.map(a):[a(e)],new r.PublicKey(t))[0]}function o(e,t){return{pubkey:new r.PublicKey(e),isWritable:!0,isSigner:t}}function u(e,t){return{pubkey:new r.PublicKey(e),isWritable:!1,isSigner:t}}function c(e){if(null===e)throw Error("account info is null");return e.data}},99534:function(e,t,n){n.d(t,{Gh:function(){return s},hI:function(){return a}});var r=n(2718),i=n(40845);let a=new r.PublicKey("BPFLoaderUpgradeab1e11111111111111111111111");function s(e){return(0,i.xc)([new r.PublicKey(e).toBuffer()],a)}}}]);